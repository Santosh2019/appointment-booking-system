<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>My Appointments</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .status-scheduled { color: #0d6efd; font-weight: bold; }
        .status-completed  { color: #198754; }
        .status-cancelled  { color: #dc3545; }










    </style>
</head>
<body class="bg-light">

<div class="container mt-5 mb-5">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>My Appointments</h2>
        <a th:href="@{/dashboard}" class="btn btn-outline-secondary">Back to Dashboard</a>
    </div>

    <div sec:authorize="hasRole('PATIENT')">
        <p class="lead">Logged in as: <strong sec:authentication="name"></strong></p>
    </div>

    <div th:if="${appointments != null and not #lists.isEmpty(appointments)}">
        <div class="table-responsive">
            <table class="table table-hover table-bordered align-middle">
                <thead class="table-dark">
                <tr>
                    <th>Appointment ID</th>
                    <th>Doctor</th>
                    <th>Specialization</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Day</th>
                    <th>Reason</th>
                    <th>Status</th>
                    <th>Booked On</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="appt : ${appointments}">
                    <td th:text="${appt.appointmentId}"></td>
                    <td th:text="${appt.doctorName} + ' (' + ${appt.doctorId} + ')'"></td>
                    <td th:text="${appt.specialization}"></td>

                    <!-- Use pre-formatted fields if available, fallback to formatting appointmentDate -->
                    <td th:text="${appt.date != null} ? ${appt.date} : ${#temporals.format(appt.appointmentDate, 'dd MMMM yyyy')}"></td>
                    <td th:text="${appt.time != null} ? ${appt.time} : ${#temporals.format(appt.appointmentDate, 'hh:mm a')}"></td>
                    <td th:text="${appt.day}"></td>

                    <td th:text="${appt.reason}"></td>

                    <td>
                        <span th:classappend="'status-' + ${#strings.toLowerCase(appt.status)}"
                              th:text="${appt.status}"></span>
                    </td>

                    <td th:text="${#temporals.format(appt.createdAt, 'dd MMM yyyy, hh:mm a')}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div th:unless="${appointments != null and not #lists.isEmpty(appointments)}" class="alert alert-info mt-4">
        <strong>No appointments found.</strong> Book your first appointment now!
        <a th:href="@{/appointments/book}" class="alert-link">Book Appointment</a>
    </div>

</div>

</body>
</html>